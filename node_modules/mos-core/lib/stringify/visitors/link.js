'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _encloseUri = require('./enclose-uri');

var _encloseUri2 = _interopRequireDefault(_encloseUri);

var _encloseTitle = require('./enclose-title');

var _encloseTitle2 = _interopRequireDefault(_encloseTitle);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*
 * Expression for a protocol.
 *
 * @see http://en.wikipedia.org/wiki/URI_scheme#Generic_syntax
 */

var PROTOCOL = /^[a-z][a-z+.-]+:\/?/i;
var MAILTO = 'mailto:';

exports.default = function (compiler, node) {
  var url = compiler.encode(node.url, node);
  var exit = compiler.enterLink();
  var escapedURL = compiler.encode(compiler.escape(node.url, node));
  var value = compiler.all(node).join('');

  exit();

  if (node.title === null && PROTOCOL.test(url) && (escapedURL === value || escapedURL === MAILTO + value)) {
    /*
     * '\\' escapes do not work in autolinks,
     * so we do not escape.
     */

    return (0, _encloseUri2.default)(compiler.encode(node.url), true);
  }

  url = (0, _encloseUri2.default)(url);

  if (node.title) {
    url += ' ' + (0, _encloseTitle2.default)(compiler.encode(compiler.escape(node.title, node), node));
  }

  value = '[' + value + ']';

  value += '(' + url + ')';

  return value;
};

module.exports = exports['default'];