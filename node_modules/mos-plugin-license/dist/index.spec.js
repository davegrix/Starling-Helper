'use strict';

var _mocha = require('mocha');

var _chai = require('chai');

var _index = require('./index');

var _index2 = _interopRequireDefault(_index);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var path = require('path');
var fs = require('fs');
var ROOT = path.resolve(__dirname, '../test/fixtures');
var fixtures = fs.readdirSync(ROOT).filter(function (filepath) {
  return filepath.indexOf('.') !== 0;
});

var mos = require('mos-processor');
var ejs = require('mos-plugin-ejs');


(0, _mocha.describe)('mos-plugin-toc', function () {
  fixtures.forEach(function (fixture) {
    var filepath = path.join(ROOT, fixture);
    var output = fs.readFileSync(path.join(filepath, 'output.md'), 'utf-8');
    var inputPath = path.join(filepath, 'input.md');
    var input = fs.readFileSync(inputPath, 'utf-8');
    var configPath = path.join(filepath, 'config.json');
    var config = fs.existsSync(configPath) ? JSON.parse(fs.readFileSync(configPath, 'utf-8')) : {};

    (0, _mocha.it)('should pass fixture in dir ' + filepath, function (done) {
      mos({ content: input, filePath: inputPath }, [ejs, { register: _index2.default, options: config }]).then(function (processor) {
        return processor.process();
      }).then(function (result) {
        (0, _chai.expect)(result).to.eq(output);
        done();
      }).catch(done);
    });
  });
});